<%- include('../admin/header.ejs') %>

	<!-- SIDEBAR -->
	<section id="sidebar">
		<a href="#" class="brand">
			<i class='bx bxs-smile'></i>
			<span class="text">LapMania</span>
		</a>
		<ul class="side-menu top">
			<li class="active">
				<a href="/admin/home">
					<i class='bx bxs-dashboard'></i>
					<span class="text">Dashboard</span>
				</a>
			</li>
			<li>
				<a href="/admin/customers">
					<i class='bx bxs-user-account'></i>
					<span class="text">Customers</span>
				</a>
			</li>
			<li>
				<a href="/admin/orders">
					<i class='bx bxs-shopping-bags'></i>
					<span class="text">Orders</span>
				</a>
			</li>
			<li>
				<a href="/admin/category">
					<i class='bx bx-category'></i>
					<span class="text">Categories</span>
				</a>
			</li>
			<li>
				<a href="/admin/Products">
					<i class='bx bxs-cart-alt'></i>
					<span class="text">Products</span>
				</a>
			</li>
			<li>
				<a href="/admin/banner">
					<i class='bx bxs-carousel'></i>
					<span class="text">Banner</span>
				</a>
			</li>
			<li>
				<a href="/admin/coupon">
					<i class='bx bxs-coupon'></i>
					<span class="text">Coupon</span>
				</a>
			</li>
			<li>
				<a href="/admin/sales">
					<i class='bx bx-money'></i>
					<span class="text">Sales</span>
				</a>
			</li>

		</ul>
		<ul class="side-menu">

			<li>
				<a href="/admin/logout" class="logout">
					<i class='bx bxs-log-out-circle'></i>
					<span class="text">Logout</span>
				</a>
			</li>
		</ul>
	</section>
	<!-- SIDEBAR -->



	<!-- CONTENT -->
	<section id="content">
		<!-- NAVBAR -->
		<nav>
			<i class='bx bx-menu' style="display: none;"></i>
			<a href="#" class="nav-link " style="display: none;">Categories</a>
			<form action="#">
				<div class="form-input" style="display: none;">
					<input type="search" placeholder="Search...">
					<button type="submit" class="search-btn"><i class='bx bx-search'></i></button>
				</div>
			</form>
			<input type="checkbox" id="switch-mode" hidden>
			<label for="switch-mode" class="switch-mode"></label>
			<a href="#" class="notification">
				<i class='bx bxs-bell'></i>
				<span class="num">8</span>
			</a>
			<a href="#" class="profile">
				<img src="img/people.png">
			</a>
		</nav>
		<!-- NAVBAR -->

		<!-- MAIN -->
		<main>
			<div class="head-title">
				<div class="left">
					<h1>Dashboard</h1>
					<ul class="breadcrumb">
						<li>
							<a href="#">Dashboard</a>
						</li>
						<li><i class='bx bx-chevron-right'></i></li>
						<li>
							<a class="active" href="#">Home</a>
						</li>
					</ul>
				</div>

			</div>

			<ul class="box-info">
				<li>
					<i class='bx bxl-shopify'></i>
					<span class="text">
						<h3>
							<%=count%>
						</h3>
						<p>Orders</p>
					</span>
				</li>
				<li>
					<i class='bx bxs-group'></i>
					<span class="text">
						<h3>
							<%=uscount%>
						</h3>
						<p>Customers</p>
					</span>
				</li>
				<li>
					<i class='bx bx-rupee '></i>
					<span class="text">
						<h3>â‚¹<%=earnings%>
						</h3>
						<p>Total Sales</p>
					</span>
				</li>

			</ul>
			<ul class="box-info">
				<li>
					<i class='bx bx-box bg-success text-white'></i>
					<span class="text">
						<h3>
							<%=deliveredCount%>
						</h3>
						<p>Delivered</p>
					</span>
				</li>
				<li>
					<i class='bx bx-window-close  text-white bg-danger'></i>
					<span class="text">
						<h3>
							<%=cancelledCount%>
						</h3>
						<p>Cancelled</p>
					</span>
				</li>
				<li>
					<i class='bx bxs-truck  text-white bg-primary'></i>
					<span class="text">
						<h3>
							<%=placedCount%>
						</h3>
						<p>Order Placed</p>
					</span>
				</li>

			</ul>

			</div>
			<%for(let i=0;i<categorySales.length;i++){%>
				<input type="hidden" class="category-sales" value="<%=categorySales[i].sales%>">
				<%}%>

					<div class="row">
						<div class="table-data" >
							<div class="col-sm-8 col-md-5 col-12 py-5 ">
								<canvas id="chart-line" width="299" height="200" class="chartjs-render-monitor "
									style="display:inline-block; width: 299px; height: 200px;">
								</canvas>
							</div>


							<div class="col-sm-8 col-md-6 col-6 " style="width: 670px;">
								
								<canvas id="barChart" class="mt-5"></canvas>
								<input type="hidden" id="days" value="<%=days%>">
								<input type="hidden" id="totals" value="<%=totals%>">

							</div>
						</div>
					</div>



					</div>



					<div class="table-data">
						<div class="order">
							<div class="head">
								<h3>Recent Orders</h3>
								<!-- <i class='bx bx-search' ></i>
						<i class='bx bx-filter' ></i> -->
							</div>
							<table>
								<thead>
									<tr>
										<th>Sl.No</th>
										<th>OrderId</th>
										<th>User</th>
										<th>Date Order</th>
										<th>Payment</th>
										<th>OrderStatus</th>
										<th>More</th>
									</tr>
								</thead>
								<tbody>

									<% if(orders.length> 0){
										for(let i=0; i <orders.length; i++){ %>
											<tr>
												<td>
													<%= i+1 %>
												</td>
												<td><%=orders[i]._id%></td>
												<td>
													<%= orders[i].userId.name %>
												</td>
												<td>
													<%= orders[i].date%>
												</td>
												<td><% if(orders[i].paymentStatus == 'Cancelled'){%>
													<span style="background-color:#fa5252;" class="status completed"><%=orders[i].paymentStatus%></span></td>
												   
												   <%}else if(orders[i].paymentStatus == 'Completed') {%>
													<span style="background-color:#26a541;" class="status completed"><%=orders[i].paymentStatus%></span></td>
													
												   <%}else if(orders[i].paymentStatus == 'Refunded') {%>
														<span style="background-color:orange;" class="status completed"><%=orders[i].paymentStatus%></span></td>
												   <%}else if(orders[i].paymentStatus == 'Pending') {%>
															<span  class="status completed bg-info"><%=orders[i].paymentStatus%></span></td>
														  
												   <%}%>
							
												<td>
													<% if(orders[i].orderStatus=='Cancelled' ){%>
														<span style="background-color:#fa5252;"
															class="status completed">
															<%=orders[i].orderStatus%>
														</span>
												</td>

												<%}else if(orders[i].orderStatus=='Delivered' ) {%>
													<span style="background-color:#26a541;" class="status completed">
														<%=orders[i].orderStatus%>
													</span></td>

													<%}else if(orders[i].orderStatus=='Placed' ) {%>
														<span style="background-color:orange;" class="status completed">
															<%=orders[i].orderStatus%>
														</span></td>
														<%}else if(orders[i].orderStatus=='Out for Delivery' ) {%>
															<span style="background-color:cornflowerblue;"
																class="status completed">
																<%=orders[i].orderStatus%>
															</span></td>

															<%}%>
															<td> <a href="/admin/orderDetails?id=<%=orders[i]._id%>" class="btn btn-outline-info">Info</a>
															</td>
											</tr>
											<% } }else{ %>
												<tr>
													<td colspan="5">Orders Not Found </td>
												</tr>
												<% } %>

								</tbody>
							</table>

						</div>
						<!-- <div class="todo">
					<div class="head">
						<h3>Todos</h3>
						<i class='bx bx-plus' ></i>
						<i class='bx bx-filter' ></i>
					</div> -->
						<!-- <ul class="todo-list">
						<li class="completed">
							<p>Todo List</p>
							<i class='bx bx-dots-vertical-rounded' ></i>
						</li>
						<li class="completed">
							<p>Todo List</p>
							<i class='bx bx-dots-vertical-rounded' ></i>
						</li>
						<li class="not-completed">
							<p>Todo List</p>
							<i class='bx bx-dots-vertical-rounded' ></i>
						</li>
						<li class="completed">
							<p>Todo List</p>
							<i class='bx bx-dots-vertical-rounded' ></i>
						</li>
						<li class="not-completed">
							<p>Todo List</p>
							<i class='bx bx-dots-vertical-rounded' ></i>
						</li>
					</ul> -->


					</div>
		</main>
		<!-- MAIN -->
	</section>
	<!-- CONTENT -->
	<script src='https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.1.4/Chart.bundle.min.js'></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<script>
		$(document).ready(function () {
			var ctx = $("#chart-line");
			var inputs = document.querySelectorAll('.category-sales');
			console.log(inputs);
			var values = [];

			inputs.forEach((input) => {
				values.push(parseFloat(input.value))
			});
			console.log(values);
			var myLineChart = new Chart(ctx, {

				type: 'pie',
				data: {
					labels: ["BUSSINESS LAPTOP","GAMING LAPTOP","KEYBOARD","MOUSE" ],
					datasets: [{
						data: values,
						backgroundColor: ["#FF6384", "rgba(100, 255, 0, 0.5)", "rgba(200, 50, 255, 0.5)", "rgba(0, 100, 255, 0.5)"]
					}]
				},
				options: {
					title: {
						display: true,
						text: 'Category wise Sales'
					}
				}
			});
		});
		//bar
		var ctxB = document.getElementById("barChart").getContext('2d');
		var days = document.getElementById('days');
		days = days.value
		var totals = document.getElementById('totals').value;
		const daysArray = JSON.parse(days);
		const totalsArray = JSON.parse(totals);
		

			
			
		var myBarChart = new Chart(ctxB, {
			type: 'bar',
			data: {
				labels: daysArray,
				datasets: [{
					label: 'Orders',
					data: totalsArray,
					backgroundColor: [
						'rgba(255, 99, 132, 0.2)',
						'rgba(54, 162, 235, 0.2)',
						'rgba(255, 206, 86, 0.2)',
						'rgba(75, 192, 192, 0.2)',
						'rgba(153, 102, 255, 0.2)',
						'rgba(255, 159, 64, 0.2)',
						'rgba(255, 6, 211, 0.32)'
					],
					borderColor: [
						'rgba(255,99,132,1)',
						'rgba(54, 162, 235, 1)',
						'rgba(255, 206, 86, 1)',
						'rgba(75, 192, 192, 1)',
						'rgba(153, 102, 255, 1)',
						'rgba(255, 159, 64, 1)',
						'rgba(255, 6, 211, 0.32)'
					],
					borderWidth: 1
				}]
			},
			options: {
				scales: {
					yAxes: [{
						ticks: {
							beginAtZero: true
						}
					}],
					xAxes:[{
						barPercentage:0.6,
						categoryPercentage:0.6
					}]
				}
			}
		});
	</script>

	<%- include('../admin/footer.ejs') %>